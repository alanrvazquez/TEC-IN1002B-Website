<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.42">

  <meta name="author" content="Alan R. Vazquez">
  <title>IN1002B Introduction to Data Science Projects – Data preprocessing</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-2f366650f320edcfcf53d73c80250a32.css">
  <link rel="stylesheet" href="../style.css">
  <link rel="stylesheet" href="style.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-pointer/pointer.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Data preprocessing</h1>
  <p class="subtitle">IN1002B: Introduction to Data Science Projects</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Alan R. Vazquez 
</div>
        <p class="quarto-title-affiliation">
            Department of Industrial Engineering
          </p>
    </div>
</div>

</section>
<section id="agenda" class="slide level2">
<h2>Agenda</h2>
<p><br></p>
<ol type="1">
<li>Introduction</li>
<li>Training, validation, and test datasets</li>
<li>Dealing with missing values</li>
<li>Transforming predictors</li>
<li>Standarization</li>
<li>Dimension reduction</li>
</ol>
</section>
<section>
<section id="introduction" class="title-slide slide level1 center">
<h1>Introduction</h1>

</section>
<section id="data-preprocessing" class="slide level2">
<h2>Data preprocessing</h2>
<p><span style="color:lightblue;"><strong>Data pre-processing</strong></span> techniques generally refer to the addition, deletion, or transformation of data.</p>
<p><br></p>
<blockquote>
<p>It can make or break a model’s predictive ability.</p>
</blockquote>
<p><br></p>
<p>For example, linear regression models (to be discussed later) are relatively insensitive to the characteristics of the predictor data, but advanced methods like K-nearest neighbors, principal component regression, and LASSO are not.</p>
</section>
<section id="section" class="slide level2">
<h2></h2>
<p><br></p>
<p>We will review some common strategies for removing predictors from the data, without considering how they might be related to the response.</p>
<div class="fragment">
<p>In particular, we will review:</p>
<div>
<ul>
<li class="fragment">Dealing with missing values.</li>
<li class="fragment">Transforming categorical predictors.</li>
<li class="fragment">Filtering: Removing non-informative or correlated predictors.</li>
<li class="fragment">Standardization.</li>
</ul>
</div>
</div>
</section>
<section id="scikit-learn-library" class="slide level2">
<h2>scikit-learn library</h2>
<ul>
<li><strong>scikit-learn</strong> is a robust and popular library for machine learning in Python</li>
<li>It provides simple, efficient tools for data mining and data analysis</li>
<li>It is built on top of libraries such as <strong>NumPy</strong>, <strong>SciPy</strong>, and <strong>Matplotlib</strong></li>
<li><a href="https://scikit-learn.org/stable/" class="uri">https://scikit-learn.org/stable/</a></li>
</ul>

<img data-src="images/scikitlearn.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="section-1" class="slide level2">
<h2></h2>
<p><br></p>
<p>Let’s import <strong>scikit-learn</strong> into Python together with the other relevant libraries.</p>
<div id="c9dd6a90" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-4"><a></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb1-5"><a></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> VarianceThreshold</span>
<span id="cb1-6"><a></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-7"><a></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> power_transform, StandardScaler </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will not use all the functions from the <strong>scikit-learn</strong> library. Instead, we will use specific functions from the sub-libraries <strong>preprocessing</strong>, <strong>feature_selection</strong>, <strong>model_selection</strong> and <strong>impute</strong>.</p>
</section></section>
<section>
<section id="training-validation-and-test-datasets" class="title-slide slide level1 center">
<h1>Training, validation, and test datasets</h1>

</section>
<section id="recall-that" class="slide level2">
<h2>Recall that …</h2>
<p><br><br></p>
<p>In data science, we assume that</p>
<p><span class="math display">\[Y = f(\boldsymbol{X}) + \epsilon\]</span></p>
<p>where <span class="math inline">\(f(\boldsymbol{X})\)</span> represents the true relationship between <span class="math inline">\(\boldsymbol{X} = (X_1, X_2, \ldots, X_p)\)</span> and <span class="math inline">\(Y\)</span>.</p>
<ul>
<li><span class="math inline">\(f(\boldsymbol{X})\)</span> is unknown and very complex!</li>
</ul>
</section>
<section id="two-datasets" class="slide level2">
<h2>Two datasets</h2>
<p><br><br></p>
<p>The application of data science models needs two data sets:</p>
<div>
<ul>
<li class="fragment"><p><span style="color:blue;"><strong>Training data</strong></span> is data that we use to train or construct the estimated function <span class="math inline">\(\hat{f}(\boldsymbol{X})\)</span>.</p></li>
<li class="fragment"><p><span style="color:green;"><strong>Test data</strong></span> is data that we use to evaluate the predictive performance of <span class="math inline">\(\hat{f}(\boldsymbol{X})\)</span> only.</p></li>
</ul>
</div>
</section>
<section id="section-2" class="slide level2">
<h2></h2>
<div class="columns">
<div class="column" style="width:30%;">
<p><img data-src="images/training.png" width="256"></p>
</div><div class="column" style="width:70%;">
<p><br></p>
<p>A random sample of <span class="math inline">\(n\)</span> observations.</p>
<p>Use it to <strong>construct</strong> <span class="math inline">\(\hat{f}(\boldsymbol{X})\)</span>.</p>
</div></div>
<div class="columns">
<div class="column" style="width:30%;">
<p><img data-src="images/test.png" width="262"></p>
</div><div class="column" style="width:70%;">
<p>Another random sample of <span class="math inline">\(n_t\)</span> observations, which is independent of the training data.</p>
<p>Use it to <strong>evaluate</strong> <span class="math inline">\(\hat{f}(\boldsymbol{X})\)</span>.</p>
</div></div>
</section>
<section id="validation-dataset" class="slide level2">
<h2>Validation Dataset</h2>
<p>In many practical situations, a test dataset is not available. To overcome this issue, we use a <span style="color:orange;"><strong>validation dataset</strong></span>.</p>

<img data-src="images/validation.png" class="quarto-figure quarto-figure-center r-stretch" width="645"><div class="fragment">
<p><strong>Idea</strong>: Apply model to your <span style="color:orange;"><strong>validation dataset</strong></span> to mimic what will happen when you apply it to test dataset.</p>
</div>
</section>
<section id="example-1" class="slide level2">
<h2>Example 1</h2>
<p><br></p>
<p>The “BostonHousing.xlsx” contains data collected by the US Bureau of the Census concerning housing in the area of Boston, Massachusetts. The dataset includes data on 506 census housing tracts in the Boston area in 1970s.</p>
<p>The goal is to predict the median house price in new tracts based on information such as crime rate, pollution, and number of rooms.</p>
<p>The response is the median value of owner-occupied homes in $1000s, contained in the column <code>MEDV</code>.</p>
</section>
<section id="the-predictors" class="slide level2">
<h2>The predictors</h2>
<div style="font-size: 70%;">
<ul>
<li><code>CRIM</code>: per capita crime rate by town.</li>
<li><code>ZN</code>: proportion of residential land zoned for lots over 25,000 sq.ft.</li>
<li><code>INDUS</code>: proportion of non-retail business acres per town.</li>
<li><code>CHAS</code>: Charles River dummy variable (= 1 if tract bounds river; 0 otherwise).</li>
<li><code>NOX</code>: nitrogen oxides concentration (parts per 10 million).</li>
<li><code>RM</code>: average number of rooms per dwelling.</li>
<li><code>AGE</code>: proportion of owner-occupied units built prior to 1940.</li>
<li><code>DIS</code>: weighted mean of distances to five Boston employment centers</li>
<li><code>RAD</code>: index of accessibility to radial highways.</li>
<li><code>TAX</code>: full-value property-tax rate per $10,000.</li>
<li><code>PTRATIO</code>: pupil-teacher ratio by town.</li>
<li><code>LSTAT</code>: lower status of the population (percent).</li>
</ul>
</div>
</section>
<section id="read-the-dataset" class="slide level2">
<h2>Read the dataset</h2>
<p>We read the dataset and set the variable <code>CHAS</code> as categorical.</p>
<div id="a2d8c726" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a></a><span class="co"># Load Excel file (make sure the file is in your Colab)</span></span>
<span id="cb2-2"><a></a>Boston_data <span class="op">=</span> pd.read_excel(<span class="st">'BostonHousing.xlsx'</span>)</span>
<span id="cb2-3"><a></a></span>
<span id="cb2-4"><a></a><span class="co"># Drop the categorical variable.</span></span>
<span id="cb2-5"><a></a>Boston_data[<span class="st">'CHAS'</span>] <span class="op">=</span> pd.Categorical(Boston_data[<span class="st">'CHAS'</span>])</span>
<span id="cb2-6"><a></a></span>
<span id="cb2-7"><a></a><span class="co"># Preview the dataset.</span></span>
<span id="cb2-8"><a></a>Boston_data.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CRIM</th>
<th data-quarto-table-cell-role="th">ZN</th>
<th data-quarto-table-cell-role="th">INDUS</th>
<th data-quarto-table-cell-role="th">CHAS</th>
<th data-quarto-table-cell-role="th">NOX</th>
<th data-quarto-table-cell-role="th">RM</th>
<th data-quarto-table-cell-role="th">AGE</th>
<th data-quarto-table-cell-role="th">DIS</th>
<th data-quarto-table-cell-role="th">RAD</th>
<th data-quarto-table-cell-role="th">TAX</th>
<th data-quarto-table-cell-role="th">PTRATIO</th>
<th data-quarto-table-cell-role="th">LSTAT</th>
<th data-quarto-table-cell-role="th">MEDV</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.00632</td>
<td>18.0</td>
<td>2.31</td>
<td>0</td>
<td>0.538</td>
<td>6.575</td>
<td>65.2</td>
<td>4.0900</td>
<td>1</td>
<td>296</td>
<td>15.3</td>
<td>4.98</td>
<td>24.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.02731</td>
<td>0.0</td>
<td>7.07</td>
<td>0</td>
<td>0.469</td>
<td>6.421</td>
<td>78.9</td>
<td>4.9671</td>
<td>2</td>
<td>242</td>
<td>17.8</td>
<td>9.14</td>
<td>21.6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.02729</td>
<td>0.0</td>
<td>7.07</td>
<td>0</td>
<td>0.469</td>
<td>7.185</td>
<td>61.1</td>
<td>4.9671</td>
<td>2</td>
<td>242</td>
<td>17.8</td>
<td>4.03</td>
<td>34.7</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="how-do-we-generate-validation-data" class="slide level2">
<h2>How do we generate validation data?</h2>
<p>We split the current dataset into a training and a validation dataset. To this end, we use the function <code>train_test_split()</code> from <strong>scikit-learn</strong>.</p>
<div id="6d362bdd" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a></a><span class="co"># Set full matrix of predictors.</span></span>
<span id="cb3-2"><a></a>X_full <span class="op">=</span> Boston_data.drop(columns <span class="op">=</span> [<span class="st">'MEDV'</span>]) </span>
<span id="cb3-3"><a></a></span>
<span id="cb3-4"><a></a><span class="co"># Set full matrix of responses.</span></span>
<span id="cb3-5"><a></a>Y_full <span class="op">=</span> Boston_data[<span class="st">'MEDV'</span>]</span>
<span id="cb3-6"><a></a></span>
<span id="cb3-7"><a></a><span class="co"># Split the dataset into training and validation.</span></span>
<span id="cb3-8"><a></a>X_train, X_valid, Y_train, Y_valid <span class="op">=</span> train_test_split(X_full, Y_full, </span>
<span id="cb3-9"><a></a>                                                      test_size<span class="op">=</span><span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The parameter <code>test_size</code> sets the portion of the dataset that will go to the validation set.</p>
</section>
<section id="section-3" class="slide level2">
<h2></h2>
<p><br><br></p>
<ul>
<li><p>The function makes a clever partition of the data using the <em>empirical</em> distribution of the response.</p></li>
<li><p>Technically, it splits the data so that the distribution of the response under the training and validation sets is similar.</p></li>
<li><p>Usually, the proportion of the dataset that goes to the validation set is 20% or 30%.</p></li>
</ul>
</section>
<section id="section-4" class="slide level2">
<h2></h2>
<p>The predictors and response in the training dataset are in the objects <code>X_train</code> and <code>Y_train</code>, respectively. We can compile these objects into a single dataset using the function <code>.concat</code> from <strong>pandas</strong>.</p>
<div id="0f51ae17" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a></a><span class="co"># Split the dataset into training and validation.</span></span>
<span id="cb4-2"><a></a>training_dataset <span class="op">=</span> pd.concat([X_train, Y_train])</span>
<span id="cb4-3"><a></a>training_dataset.head(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CRIM</th>
<th data-quarto-table-cell-role="th">ZN</th>
<th data-quarto-table-cell-role="th">INDUS</th>
<th data-quarto-table-cell-role="th">CHAS</th>
<th data-quarto-table-cell-role="th">NOX</th>
<th data-quarto-table-cell-role="th">RM</th>
<th data-quarto-table-cell-role="th">AGE</th>
<th data-quarto-table-cell-role="th">DIS</th>
<th data-quarto-table-cell-role="th">RAD</th>
<th data-quarto-table-cell-role="th">TAX</th>
<th data-quarto-table-cell-role="th">PTRATIO</th>
<th data-quarto-table-cell-role="th">LSTAT</th>
<th data-quarto-table-cell-role="th">MEDV</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">274</td>
<td>0.05644</td>
<td>40.0</td>
<td>6.41</td>
<td>1</td>
<td>0.447</td>
<td>6.758</td>
<td>32.9</td>
<td>4.0776</td>
<td>4.0</td>
<td>254.0</td>
<td>17.6</td>
<td>3.53</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">57</td>
<td>0.01432</td>
<td>100.0</td>
<td>1.32</td>
<td>0</td>
<td>0.411</td>
<td>6.816</td>
<td>40.5</td>
<td>8.3248</td>
<td>5.0</td>
<td>256.0</td>
<td>15.1</td>
<td>3.95</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">449</td>
<td>7.52601</td>
<td>0.0</td>
<td>18.10</td>
<td>0</td>
<td>0.713</td>
<td>6.417</td>
<td>98.3</td>
<td>2.1850</td>
<td>24.0</td>
<td>666.0</td>
<td>20.2</td>
<td>19.31</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">278</td>
<td>0.07978</td>
<td>40.0</td>
<td>6.41</td>
<td>0</td>
<td>0.447</td>
<td>6.482</td>
<td>32.1</td>
<td>4.1403</td>
<td>4.0</td>
<td>254.0</td>
<td>17.6</td>
<td>7.19</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="section-5" class="slide level2">
<h2></h2>
<p>Equivalently, the predictors and response in the validation dataset are in the objects <code>X_valid</code> and <code>Y_valid</code>, respectively.</p>
<div id="3cd288b4" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a></a><span class="co"># Split the dataset into training and validation.</span></span>
<span id="cb5-2"><a></a>validation_dataset <span class="op">=</span> pd.concat([X_valid, Y_valid])</span>
<span id="cb5-3"><a></a>validation_dataset.head(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CRIM</th>
<th data-quarto-table-cell-role="th">ZN</th>
<th data-quarto-table-cell-role="th">INDUS</th>
<th data-quarto-table-cell-role="th">CHAS</th>
<th data-quarto-table-cell-role="th">NOX</th>
<th data-quarto-table-cell-role="th">RM</th>
<th data-quarto-table-cell-role="th">AGE</th>
<th data-quarto-table-cell-role="th">DIS</th>
<th data-quarto-table-cell-role="th">RAD</th>
<th data-quarto-table-cell-role="th">TAX</th>
<th data-quarto-table-cell-role="th">PTRATIO</th>
<th data-quarto-table-cell-role="th">LSTAT</th>
<th data-quarto-table-cell-role="th">MEDV</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">370</td>
<td>6.53876</td>
<td>0.0</td>
<td>18.10</td>
<td>1</td>
<td>0.631</td>
<td>7.016</td>
<td>97.5</td>
<td>1.2024</td>
<td>24.0</td>
<td>666.0</td>
<td>20.2</td>
<td>2.96</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">205</td>
<td>0.13642</td>
<td>0.0</td>
<td>10.59</td>
<td>0</td>
<td>0.489</td>
<td>5.891</td>
<td>22.3</td>
<td>3.9454</td>
<td>4.0</td>
<td>277.0</td>
<td>18.6</td>
<td>10.87</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">136</td>
<td>0.32264</td>
<td>0.0</td>
<td>21.89</td>
<td>0</td>
<td>0.624</td>
<td>5.942</td>
<td>93.5</td>
<td>1.9669</td>
<td>4.0</td>
<td>437.0</td>
<td>21.2</td>
<td>16.90</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">490</td>
<td>0.20746</td>
<td>0.0</td>
<td>27.74</td>
<td>0</td>
<td>0.609</td>
<td>5.093</td>
<td>98.0</td>
<td>1.8226</td>
<td>4.0</td>
<td>711.0</td>
<td>20.1</td>
<td>29.68</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="work-on-your-training-dataset" class="slide level2">
<h2>Work on your training dataset</h2>
<p>After we have partitioned the data, we <strong>work on the</strong> <span style="color:blue;"><strong>training data</strong></span> to develop our predictive pipeline.</p>
<p>The pipeline has two main steps:</p>
<ol type="1">
<li>Data preprocessing.</li>
<li>Model development.</li>
</ol>
<p>We will now discuss preprocessing techniques applied to the training dataset. Note that all the techniques applied to this dataset will also be applied to the <span style="color:orange;"><strong>validation dataset</strong></span> and <span style="color:green;"><strong>test dataset</strong></span> to prepare it for your model.</p>
</section></section>
<section>
<section id="dealing-with-missing-values" class="title-slide slide level1 center">
<h1>Dealing with missing values</h1>

</section>
<section id="missing-values" class="slide level2">
<h2>Missing values</h2>
<p>In many cases, some predictors have no values for a given observation. It is important to understand why the values are missing.</p>
<p><br></p>
<div class="fragment">
<p>There four main types of missing data:</p>
<div>
<ul>
<li class="fragment"><p><em>Structurally missing</em> data is data that is missing for a logical reason or because it should not exist.</p></li>
<li class="fragment"><p><em>Missing completely at random</em> assumes that the fact that the data is missing is unrelated to the other information in the data.</p></li>
</ul>
</div>
</div>
</section>
<section id="section-6" class="slide level2">
<h2></h2>
<p><br><br></p>
<ul>
<li><p><em>Missing at random</em> assumes that we can predict the value that is missing based on the other available data.</p></li>
<li><p><em>Missing not at random</em> assumes that there is a mechanism that generates the missing values, which may include observed and unobserved predictors.</p></li>
</ul>
</section>
<section id="section-7" class="slide level2">
<h2></h2>
<p>For large data sets, removal of observations based on missing values is not a problem, assuming that the type of missing data is completely at random.</p>
<p><br></p>
<p>In a smaller data sets, there is a high price in removing observations. To overcome this issue, we can use methods of imputation, which try to estimate the missing values of a predictor variable using the other predictors’ values.</p>
<p><br></p>
<p>Here, we will introduce three simple methods for imputing missing values in categorical and numerical variables.</p>
</section>
<section id="example-2" class="slide level2">
<h2>Example 2</h2>
<p><br></p>
<p>Let’s use the penguins dataset available in the file <code>penguins.xlsx</code>.</p>
<div id="1926620a" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a></a><span class="co"># Load the Excel file into a pandas DataFrame.</span></span>
<span id="cb6-2"><a></a>penguins_data <span class="op">=</span> pd.read_excel(<span class="st">"penguins.xlsx"</span>)</span>
<span id="cb6-3"><a></a></span>
<span id="cb6-4"><a></a><span class="co"># Set categorical variables.</span></span>
<span id="cb6-5"><a></a>penguins_data[<span class="st">'sex'</span>] <span class="op">=</span> pd.Categorical(penguins_data[<span class="st">'sex'</span>])</span>
<span id="cb6-6"><a></a>penguins_data[<span class="st">'species'</span>] <span class="op">=</span> pd.Categorical(penguins_data[<span class="st">'species'</span>])</span>
<span id="cb6-7"><a></a>penguins_data[<span class="st">'island'</span>] <span class="op">=</span> pd.Categorical(penguins_data[<span class="st">'island'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-8" class="slide level2">
<h2></h2>
<p><br></p>
<p>The dataset has some missing values denoted as <code>NaN</code>.</p>
<div id="0943f139" class="cell" data-execution_count="7">
<div class="cell-output cell-output-display" data-execution_count="7">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">species</th>
<th data-quarto-table-cell-role="th">island</th>
<th data-quarto-table-cell-role="th">bill_length_mm</th>
<th data-quarto-table-cell-role="th">bill_depth_mm</th>
<th data-quarto-table-cell-role="th">flipper_length_mm</th>
<th data-quarto-table-cell-role="th">body_mass_g</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Adelie</td>
<td>Torgersen</td>
<td>39.1</td>
<td>18.7</td>
<td>181.0</td>
<td>3750.0</td>
<td>male</td>
<td>2007</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Adelie</td>
<td>Torgersen</td>
<td>39.5</td>
<td>17.4</td>
<td>186.0</td>
<td>3800.0</td>
<td>female</td>
<td>2007</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Adelie</td>
<td>Torgersen</td>
<td>40.3</td>
<td>18.0</td>
<td>195.0</td>
<td>3250.0</td>
<td>female</td>
<td>2007</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Adelie</td>
<td>Torgersen</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2007</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Adelie</td>
<td>Torgersen</td>
<td>36.7</td>
<td>19.3</td>
<td>193.0</td>
<td>3450.0</td>
<td>female</td>
<td>2007</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="section-9" class="slide level2">
<h2></h2>
<p><br></p>
<p>One way to know what variables have missing data is using the function <code>info()</code> from <strong>pandas</strong>.</p>
<div id="decb2c6f" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a></a>penguins_data.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 344 entries, 0 to 343
Data columns (total 8 columns):
 #   Column             Non-Null Count  Dtype   
---  ------             --------------  -----   
 0   species            344 non-null    category
 1   island             344 non-null    category
 2   bill_length_mm     342 non-null    float64 
 3   bill_depth_mm      342 non-null    float64 
 4   flipper_length_mm  342 non-null    float64 
 5   body_mass_g        342 non-null    float64 
 6   sex                333 non-null    category
 7   year               344 non-null    int64   
dtypes: category(3), float64(4), int64(1)
memory usage: 14.9 KB</code></pre>
</div>
</div>
</section>
<section id="section-10" class="slide level2">
<h2></h2>
<p>In the output of the function “non-null” refers to the number of entries in a column that have actual values. That is, the number of entries where there are not <code>NaN</code>.</p>
<div id="c8b5cb3d" class="cell" data-execution_count="9">
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 344 entries, 0 to 343
Data columns (total 8 columns):
 #   Column             Non-Null Count  Dtype   
---  ------             --------------  -----   
 0   species            344 non-null    category
 1   island             344 non-null    category
 2   bill_length_mm     342 non-null    float64 
 3   bill_depth_mm      342 non-null    float64 
 4   flipper_length_mm  342 non-null    float64 
 5   body_mass_g        342 non-null    float64 
 6   sex                333 non-null    category
 7   year               344 non-null    int64   
dtypes: category(3), float64(4), int64(1)
memory usage: 14.9 KB</code></pre>
</div>
</div>
<p>The value next to “RangeIndex” is the number of observations in the dataset.</p>
</section>
<section id="section-11" class="slide level2">
<h2></h2>
<p><br></p>
<p>Alternatively, we can use the function <code>isnull()</code> together with <code>sum()</code> to determine the number of missing values for each column in the dataset.</p>
<p><br></p>
<div id="fc20222a" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a></a>missing_values <span class="op">=</span> penguins_data.isnull().<span class="bu">sum</span>()</span>
<span id="cb10-2"><a></a>missing_values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>species               0
island                0
bill_length_mm        2
bill_depth_mm         2
flipper_length_mm     2
body_mass_g           2
sex                  11
year                  0
dtype: int64</code></pre>
</div>
</div>
</section>
<section id="removing-missing-values" class="slide level2">
<h2>Removing missing values</h2>
<p>If we want to remove all rows in the dataset that have at least one missing value, we use the function <code>dropna()</code>.</p>
<div id="761be18f" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a></a>complete_penguins <span class="op">=</span> penguins_data.dropna()</span>
<span id="cb12-2"><a></a>complete_penguins.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">species</th>
<th data-quarto-table-cell-role="th">island</th>
<th data-quarto-table-cell-role="th">bill_length_mm</th>
<th data-quarto-table-cell-role="th">bill_depth_mm</th>
<th data-quarto-table-cell-role="th">flipper_length_mm</th>
<th data-quarto-table-cell-role="th">body_mass_g</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Adelie</td>
<td>Torgersen</td>
<td>39.1</td>
<td>18.7</td>
<td>181.0</td>
<td>3750.0</td>
<td>male</td>
<td>2007</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Adelie</td>
<td>Torgersen</td>
<td>39.5</td>
<td>17.4</td>
<td>186.0</td>
<td>3800.0</td>
<td>female</td>
<td>2007</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Adelie</td>
<td>Torgersen</td>
<td>40.3</td>
<td>18.0</td>
<td>195.0</td>
<td>3250.0</td>
<td>female</td>
<td>2007</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>Adelie</td>
<td>Torgersen</td>
<td>36.7</td>
<td>19.3</td>
<td>193.0</td>
<td>3450.0</td>
<td>female</td>
<td>2007</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>Adelie</td>
<td>Torgersen</td>
<td>39.3</td>
<td>20.6</td>
<td>190.0</td>
<td>3650.0</td>
<td>male</td>
<td>2007</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="imputation-using-the-mean" class="slide level2">
<h2>Imputation using the mean</h2>
<p>We can impute the missing values of a numeric variable using the <strong>mean</strong> or <strong>median</strong> of its available values. For example, consider the variable <code>bill_length_mm</code> that has missing values.</p>
<div id="80ce866a" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a></a>penguins_data[<span class="st">'bill_length_mm'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>0    39.1
1    39.5
2    40.3
3     NaN
4    36.7
Name: bill_length_mm, dtype: float64</code></pre>
</div>
</div>
<p>In <strong>scikit-learn</strong>, we use the function <code>SimpleImputer()</code> to define the method of imputation of missing values.</p>
</section>
<section id="section-12" class="slide level2">
<h2></h2>
<p><br></p>
<p>Using <code>SimpleImputer()</code>, we set the method to imput missing values using the <strong>mean</strong>. We also use the function <code>fit_transform()</code> to apply the imputation method to the variable.</p>
<div id="d7ac93b8" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a></a><span class="co"># Imputation for numerical variables (using the mean)</span></span>
<span id="cb15-2"><a></a>num_imputer <span class="op">=</span> SimpleImputer(strategy<span class="op">=</span><span class="st">'mean'</span>)</span>
<span id="cb15-3"><a></a></span>
<span id="cb15-4"><a></a><span class="co"># Replace the original variable with new version.</span></span>
<span id="cb15-5"><a></a>penguins_data[<span class="st">'bill_length_mm'</span>] <span class="op">=</span> num_imputer.fit_transform(penguins_data[ [<span class="st">'bill_length_mm'</span>] ] )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-13" class="slide level2">
<h2></h2>
<p>After imputation, the dataset looks like this.</p>
<div id="dedaaec6" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a></a>penguins_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">species</th>
<th data-quarto-table-cell-role="th">island</th>
<th data-quarto-table-cell-role="th">bill_length_mm</th>
<th data-quarto-table-cell-role="th">bill_depth_mm</th>
<th data-quarto-table-cell-role="th">flipper_length_mm</th>
<th data-quarto-table-cell-role="th">body_mass_g</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Adelie</td>
<td>Torgersen</td>
<td>39.10000</td>
<td>18.7</td>
<td>181.0</td>
<td>3750.0</td>
<td>male</td>
<td>2007</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Adelie</td>
<td>Torgersen</td>
<td>39.50000</td>
<td>17.4</td>
<td>186.0</td>
<td>3800.0</td>
<td>female</td>
<td>2007</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Adelie</td>
<td>Torgersen</td>
<td>40.30000</td>
<td>18.0</td>
<td>195.0</td>
<td>3250.0</td>
<td>female</td>
<td>2007</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Adelie</td>
<td>Torgersen</td>
<td>43.92193</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2007</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Adelie</td>
<td>Torgersen</td>
<td>36.70000</td>
<td>19.3</td>
<td>193.0</td>
<td>3450.0</td>
<td>female</td>
<td>2007</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now, <code>bill_length_mm</code> has complete values.</p>
</section>
<section id="section-14" class="slide level2">
<h2></h2>
<p>To imput the missing values using the <strong>median</strong>, we simply set this method in <code>SimpleImputer()</code>. For example, let’s imput the missing values of <code>bill_depth_mm</code>.</p>
<div id="c32be68f" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a></a><span class="co"># Imputation for numerical variables (using the mean)</span></span>
<span id="cb17-2"><a></a>num_imputer <span class="op">=</span> SimpleImputer(strategy <span class="op">=</span> <span class="st">'median'</span>)</span>
<span id="cb17-3"><a></a></span>
<span id="cb17-4"><a></a><span class="co"># Replace the original variable with new version.</span></span>
<span id="cb17-5"><a></a>penguins_data[<span class="st">'bill_depth_mm'</span>] <span class="op">=</span> num_imputer.fit_transform(penguins_data[ [<span class="st">'bill_depth_mm'</span>] ] )</span>
<span id="cb17-6"><a></a></span>
<span id="cb17-7"><a></a><span class="co"># Show the first 4 rows of the updated dataset.</span></span>
<span id="cb17-8"><a></a>penguins_data.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">species</th>
<th data-quarto-table-cell-role="th">island</th>
<th data-quarto-table-cell-role="th">bill_length_mm</th>
<th data-quarto-table-cell-role="th">bill_depth_mm</th>
<th data-quarto-table-cell-role="th">flipper_length_mm</th>
<th data-quarto-table-cell-role="th">body_mass_g</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Adelie</td>
<td>Torgersen</td>
<td>39.1</td>
<td>18.7</td>
<td>181.0</td>
<td>3750.0</td>
<td>male</td>
<td>2007</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Adelie</td>
<td>Torgersen</td>
<td>39.5</td>
<td>17.4</td>
<td>186.0</td>
<td>3800.0</td>
<td>female</td>
<td>2007</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Adelie</td>
<td>Torgersen</td>
<td>40.3</td>
<td>18.0</td>
<td>195.0</td>
<td>3250.0</td>
<td>female</td>
<td>2007</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="using-the-mean-or-the-median" class="slide level2">
<h2>Using the mean or the median?</h2>
<p><br><br></p>
<p>We use the <strong>sample mean</strong> when the data distribution is roughly symmetrical.</p>
<ul>
<li><p>Pros: Simple and easy to implement.</p></li>
<li><p>Cons: Sensitive to outliers; may not be accurate for skewed distributions</p></li>
</ul>
</section>
<section id="section-15" class="slide level2">
<h2></h2>
<p><br><br></p>
<p>We use the <strong>sample median</strong> when the data is skewed (e.g., incomes, prices).</p>
<ul>
<li><p>Pros: Less sensitive to outliers; robust for skewed distributions.</p></li>
<li><p>Cons: May reduce variability in the data.</p></li>
</ul>
</section>
<section id="imputation-method-for-a-categorical-variable" class="slide level2">
<h2>Imputation method for a categorical variable</h2>
<p>If a categorical variable has missing values, we can use the <strong>most frequent</strong> of the available values to replace the missing values. To this end, we use similar commands as before.</p>
<p>For example, let’s imput the missing values of <code>sex</code> using this strategy.</p>
<div id="8b81d878" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a></a><span class="co"># Imputation for categorical variables (using the most frequent value)</span></span>
<span id="cb18-2"><a></a>cat_imputer <span class="op">=</span> SimpleImputer(strategy <span class="op">=</span> <span class="st">'most_frequent'</span>)</span>
<span id="cb18-3"><a></a></span>
<span id="cb18-4"><a></a><span class="co"># Apply imputation strategy for categorical variables.</span></span>
<span id="cb18-5"><a></a>penguins_data[<span class="st">'sex'</span>] <span class="op">=</span> cat_imputer.fit_transform(penguins_data[ [<span class="st">'sex'</span>] ]).ravel()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section>
<section id="transforming-predictors" class="title-slide slide level1 center">
<h1>Transforming predictors</h1>

</section>
<section id="categorical-predictors" class="slide level2">
<h2>Categorical predictors</h2>
<p>A <span style="color:darkgreen;"><strong>categorical predictor</strong></span> takes on values that are nominal categories.</p>
<div class="fragment">
<p>For example:</p>
<ul>
<li><p>Type of school: Public or private.</p></li>
<li><p>Treatment: New or placebo.</p></li>
<li><p>Grade: Passed or not passed.</p></li>
</ul>
</div>
<div class="fragment">
<p>The categories can be represented by names, labels or even numbers. Their use in regression requires <strong>dummy variables</strong>, which are numeric variables.</p>
</div>
</section>
<section id="dummy-variables" class="slide level2">
<h2>Dummy variables</h2>
<p><br><br></p>
<blockquote>
<p>The traditional choice for a dummy variable is a binary variable, which can only take the values 0 and 1.</p>
</blockquote>
<p><br></p>
<p><strong><em>Initially, a categorical variable with</em></strong> <span class="math inline">\(k\)</span> <strong><em>categories requires</em></strong> <span class="math inline">\(k\)</span> <strong><em>dummy variables.</em></strong></p>
</section>
<section id="example-2-1" class="slide level2">
<h2>Example 2</h2>
<p>A market analyst is studying quality characteristics of cars. Specifically, the analyst is investigating the miles per gallon (mpg) of cars can be predicted using:</p>
<ul>
<li><span class="math inline">\(X_1:\)</span> cylinders. Number of cylinders between 4 and 8</li>
<li><span class="math inline">\(X_2:\)</span> displacement. Engine displacement (cu. inches)</li>
<li><span class="math inline">\(X_3:\)</span> horsepower. Engine horsepower</li>
<li><span class="math inline">\(X_4:\)</span> weight. Vehicle weight (lbs.)</li>
<li><span class="math inline">\(X_5:\)</span> acceleration. Time to accelerate from 0 to 60 mph (sec.)</li>
<li><span class="math inline">\(X_6:\)</span> origin. Origin of car (American, European, Japanese)</li>
</ul>
</section>
<section id="section-16" class="slide level2">
<h2></h2>
<p><br><br></p>
<p>The dataset is in the file “auto.xlsx”. Let’s read the data using <strong>pandas</strong>.</p>
<div id="fbfaa024" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a></a><span class="co"># Load the Excel file into a pandas DataFrame.</span></span>
<span id="cb19-2"><a></a>auto_data <span class="op">=</span> pd.read_excel(<span class="st">"auto.xlsx"</span>)</span>
<span id="cb19-3"><a></a></span>
<span id="cb19-4"><a></a><span class="co"># Set categorical variables.</span></span>
<span id="cb19-5"><a></a>auto_data[<span class="st">'origin'</span>] <span class="op">=</span> pd.Categorical(auto_data[<span class="st">'origin'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-17" class="slide level2">
<h2></h2>
<div id="a91910f7" class="cell" data-execution_count="18">
<div class="cell-output cell-output-display" data-execution_count="18">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">observation</th>
<th data-quarto-table-cell-role="th">mpg</th>
<th data-quarto-table-cell-role="th">cylinders</th>
<th data-quarto-table-cell-role="th">displacement</th>
<th data-quarto-table-cell-role="th">horsepower</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">acceleration</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">origin</th>
<th data-quarto-table-cell-role="th">name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>18.0</td>
<td>8</td>
<td>307.0</td>
<td>130</td>
<td>3504</td>
<td>12.0</td>
<td>70</td>
<td>American</td>
<td>chevrolet chevelle malibu</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>15.0</td>
<td>8</td>
<td>350.0</td>
<td>165</td>
<td>3693</td>
<td>11.5</td>
<td>70</td>
<td>American</td>
<td>buick skylark 320</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>18.0</td>
<td>8</td>
<td>318.0</td>
<td>150</td>
<td>3436</td>
<td>11.0</td>
<td>70</td>
<td>American</td>
<td>plymouth satellite</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>16.0</td>
<td>8</td>
<td>304.0</td>
<td>150</td>
<td>3433</td>
<td>12.0</td>
<td>70</td>
<td>American</td>
<td>amc rebel sst</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="dealing-with-missing-values-1" class="slide level2">
<h2>Dealing with missing values</h2>
<p><br></p>
<p>The dataset has missing values. In this example, we remove each row with at least one missing value.</p>
<p><br></p>
<div id="b722d1fb" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a></a><span class="co"># Remove rows with missing values.</span></span>
<span id="cb20-2"><a></a>complete_Auto <span class="op">=</span> auto_data.dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="example-2-cont." class="slide level2">
<h2>Example 2 (cont.)</h2>
<p>Categorical predictor: Origin of a car. Three categories: American, European and Japanese.</p>
<p>Initially, 3 dummy variables are required:</p>
<p><span class="math display">\[d_1 =
\begin{cases}
1 \text{ if observation is from an American car}\\
0 \text{ otherwise}
\end{cases}\]</span> <span class="math display">\[d_2 =
\begin{cases}
1 \text{ if observation is from an European car}\\
0 \text{ otherwise}
\end{cases}\]</span> <span class="math display">\[d_3 =
\begin{cases}
1 \text{ if observation is from a Japanese car}\\
0 \text{ otherwise}
\end{cases}\]</span></p>
</section>
<section id="section-18" class="slide level2">
<h2></h2>
<p>The variable Origin would then be replaced by the three dummy variables</p>
<table class="caption-top">
<thead>
<tr class="header">
<th>Origin (<span class="math inline">\(X\)</span>)</th>
<th><span class="math inline">\(d_1\)</span></th>
<th><span class="math inline">\(d_2\)</span></th>
<th><span class="math inline">\(d_3\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>American</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>American</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>European</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td>European</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>American</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>Japanese</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
</tr>
</tbody>
</table>
</section>
<section id="a-drawback" class="slide level2">
<h2>A drawback</h2>
<p><br></p>
<div>
<ul>
<li class="fragment"><p>A drawback with the initial dummy variables is that they are <span style="color:red;"><strong>linearly dependent</strong></span>. That is, <span class="math inline">\(d_1 + d_2 + d_3 = 1\)</span>.</p></li>
<li class="fragment"><p>Therefore, we can determine the value of <span class="math inline">\(d_1 = 1- d_2 - d_3.\)</span></p></li>
<li class="fragment"><p>Predictive models such as linear regression are sensitive to linear dependencies among predictors.</p></li>
<li class="fragment"><p><strong>The solution is to drop one of the predictor</strong>, say, <span class="math inline">\(d_1\)</span>, from the data.</p></li>
</ul>
</div>
</section>
<section id="section-19" class="slide level2">
<h2></h2>
<p>The variable Origin would then be replaced by the three dummy variables.</p>
<table class="caption-top">
<thead>
<tr class="header">
<th>Origin (<span class="math inline">\(X\)</span>)</th>
<th><span class="math inline">\(d_2\)</span></th>
<th><span class="math inline">\(d_3\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>American</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>American</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>European</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td>European</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>American</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>Japanese</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
</tr>
</tbody>
</table>
</section>
<section id="dummy-variables-in-python" class="slide level2">
<h2>Dummy variables in Python</h2>
<p><br></p>
<p>We can get the dummy variables of a categorical variable using the function <code>pd.get_dummies()</code> from <strong>pandas</strong>.</p>
<p>The input of the function is the categorical variable.</p>
<p>The function has an extra argument called <code>drop_first</code> to drop the first dummy variable. It also has the argument <code>dtype</code> to show the values as integers.</p>
<div id="5523b4bd" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a></a>dummy_data <span class="op">=</span> pd.get_dummies(complete_Auto[<span class="st">'origin'</span>], drop_first <span class="op">=</span> <span class="va">True</span>, </span>
<span id="cb21-2"><a></a>                            dtype <span class="op">=</span> <span class="st">'int'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-20" class="slide level2">
<h2></h2>
<p><br><br></p>
<div id="286a5db5" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a></a>dummy_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">European</th>
<th data-quarto-table-cell-role="th">Japanese</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="section-21" class="slide level2">
<h2></h2>
<p>Now, to add the dummy variables to the dataset, we use the function <code>concat()</code> from <strong>pandas</strong>.</p>
<div id="72c042f7" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a></a>augmented_auto <span class="op">=</span> pd.concat([complete_Auto, dummy_data], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb23-2"><a></a>augmented_auto.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">observation</th>
<th data-quarto-table-cell-role="th">mpg</th>
<th data-quarto-table-cell-role="th">cylinders</th>
<th data-quarto-table-cell-role="th">displacement</th>
<th data-quarto-table-cell-role="th">horsepower</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">acceleration</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">origin</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">European</th>
<th data-quarto-table-cell-role="th">Japanese</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>18.0</td>
<td>8</td>
<td>307.0</td>
<td>130</td>
<td>3504</td>
<td>12.0</td>
<td>70</td>
<td>American</td>
<td>chevrolet chevelle malibu</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>15.0</td>
<td>8</td>
<td>350.0</td>
<td>165</td>
<td>3693</td>
<td>11.5</td>
<td>70</td>
<td>American</td>
<td>buick skylark 320</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>18.0</td>
<td>8</td>
<td>318.0</td>
<td>150</td>
<td>3436</td>
<td>11.0</td>
<td>70</td>
<td>American</td>
<td>plymouth satellite</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>16.0</td>
<td>8</td>
<td>304.0</td>
<td>150</td>
<td>3433</td>
<td>12.0</td>
<td>70</td>
<td>American</td>
<td>amc rebel sst</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>17.0</td>
<td>8</td>
<td>302.0</td>
<td>140</td>
<td>3449</td>
<td>10.5</td>
<td>70</td>
<td>American</td>
<td>ford torino</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="transforming-numerical-predictors" class="slide level2">
<h2>Transforming numerical predictors</h2>
<p><br></p>
<p>A common problem with a predictor is that it may have a <em>skewed distribution</em>. That is, a distribution that accumulates many observations in smaller or larger values of the predictor.</p>
<p>For example, consider the distribution of the predictor <code>DIS</code> (weighted mean of distances to five Boston employment centers) in the <code>Boston_data</code>.</p>
</section>
<section id="section-22" class="slide level2">
<h2></h2>
<div id="776a1b26" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">4</span>)) <span class="co"># Create space for figure.</span></span>
<span id="cb24-2"><a></a>sns.histplot(data <span class="op">=</span> Boston_data, x <span class="op">=</span> <span class="st">'DIS'</span>) <span class="co"># Create the histogram.</span></span>
<span id="cb24-3"><a></a>plt.title(<span class="st">"Histogram of DIS"</span>) <span class="co"># Plot title.</span></span>
<span id="cb24-4"><a></a>plt.xlabel(<span class="st">"DIS"</span>) <span class="co"># X label</span></span>
<span id="cb24-5"><a></a>plt.show() <span class="co"># Display the plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PreProcessing_files/figure-revealjs/cell-24-output-1.png" class="quarto-figure quarto-figure-center" width="593" height="376"></p>
</figure>
</div>
</div>
</div>
<p>We see that many of the predictor values are on the right of the plot, while few are on the left.</p>
</section>
<section id="problems-with-strong-skewness" class="slide level2">
<h2>Problems with strong skewness</h2>
<p><br></p>
<p>Strong skewness in a predictor can:</p>
<ul>
<li>Distort the relationship with the response.</li>
<li>Violate the assumptions of the linear regression model (e.g., linearity, homoscedasticity).</li>
<li>Lead to influential outliers or poor model fit.</li>
</ul>
<p>To correct the skewness of a predictor’s distribution, we can transform the predictor using the <span style="color:orange;"><strong>Box-Cox transformation</strong></span></p>
</section>
<section id="box-cox-transformation" class="slide level2">
<h2>Box-Cox Transformation</h2>
<p><br></p>
<p>The Box-Cox transformation uses a family of power transformations on a predictor <span class="math inline">\(X\)</span> such that <span class="math inline">\(X' = X^{\lambda}\)</span>, where <span class="math inline">\(\lambda\)</span> is a parameter to be determined using the data. When <span class="math inline">\(\lambda = 0,\)</span> this means <span class="math inline">\(X' = \ln(X)\)</span>, where <span class="math inline">\(\ln(\cdot)\)</span> is the natural logarithm.</p>
<p>The Box-Cox transformation is the element of this family that results in a transformed variable that follows a normal distribution (approximately).</p>
<p>The variable <span class="math inline">\(X\)</span> must be strictly positive.</p>
</section>
<section id="in-python" class="slide level2">
<h2>In Python</h2>
<p>In Python, we can apply Box-Cox transformation using the <code>power_transformation</code> function of the <strong>scikit-learn</strong> library.</p>
<div id="1178cba3" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a></a>DIS_transform <span class="op">=</span> power_transform(Boston_data[ [<span class="st">'DIS'</span>]], method <span class="op">=</span> <span class="st">"box-cox"</span>)</span>
<span id="cb25-2"><a></a>DIS_transform</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>array([[ 0.44539005],
       [ 0.7895718 ],
       [ 0.7895718 ],
       [ 1.13187237],
       [ 1.13187237],
       [ 1.13187237],
       [ 0.98476034],
       [ 1.10036787],
       [ 1.13741466],
       [ 1.27270407],
       [ 1.2091752 ],
       [ 1.1770677 ],
       [ 0.9505772 ],
       [ 0.69551847],
       [ 0.60084815],
       [ 0.61537232],
       [ 0.61537232],
       [ 0.51751517],
       [ 0.31069361],
       [ 0.31069361],
       [ 0.31136437],
       [ 0.41084488],
       [ 0.39484887],
       [ 0.44767483],
       [ 0.57587376],
       [ 0.59794268],
       [ 0.6859577 ],
       [ 0.59746455],
       [ 0.59798252],
       [ 0.50956188],
       [ 0.50702845],
       [ 0.48232264],
       [ 0.40078741],
       [ 0.30623057],
       [ 0.29300743],
       [ 0.08652163],
       [ 0.09620411],
       [ 0.37533388],
       [ 0.3348514 ],
       [ 0.93478164],
       [ 0.93478164],
       [ 1.03340855],
       [ 1.03340855],
       [ 1.03340855],
       [ 1.03340855],
       [ 0.83568471],
       [ 0.83568471],
       [ 1.02398019],
       [ 1.07723642],
       [ 1.13897053],
       [ 1.32801033],
       [ 1.32801033],
       [ 1.32801033],
       [ 1.32801033],
       [ 1.44609602],
       [ 1.72546823],
       [ 1.81292616],
       [ 1.65535612],
       [ 1.55306328],
       [ 1.35632068],
       [ 1.42477442],
       [ 1.32893626],
       [ 1.4247972 ],
       [ 1.58720567],
       [ 1.81900473],
       [ 1.27760938],
       [ 1.27760938],
       [ 1.24867173],
       [ 1.24867173],
       [ 1.24867173],
       [ 0.89804596],
       [ 0.89804596],
       [ 0.89804596],
       [ 0.89804596],
       [ 0.51482656],
       [ 0.61694705],
       [ 0.42867991],
       [ 0.44560989],
       [ 0.80599219],
       [ 0.61694705],
       [ 0.93465409],
       [ 0.93465409],
       [ 0.93465409],
       [ 0.93465409],
       [ 0.72215708],
       [ 0.59119517],
       [ 0.58698795],
       [ 0.28708388],
       [ 0.12004935],
       [ 0.11615389],
       [-0.06859372],
       [-0.06871521],
       [ 0.24683231],
       [ 0.24683231],
       [ 0.22122739],
       [ 0.15928167],
       [ 0.15928167],
       [ 0.15928167],
       [ 0.15928167],
       [ 0.15928167],
       [-0.27175013],
       [-0.21877158],
       [-0.31571578],
       [-0.31571578],
       [-0.53715997],
       [-0.81126825],
       [-0.71546644],
       [-0.79666137],
       [-0.52759595],
       [-0.43999543],
       [-0.27175013],
       [-0.34219233],
       [-0.59254127],
       [-0.43779074],
       [-0.67521748],
       [-0.50356494],
       [-0.30487751],
       [-0.29278599],
       [-0.49222604],
       [-0.28458896],
       [-0.6741687 ],
       [-0.72768299],
       [-0.83030041],
       [-0.97231313],
       [-0.90919447],
       [-0.92266566],
       [-1.17831739],
       [-1.1423833 ],
       [-1.11491774],
       [-0.93583514],
       [-0.80032502],
       [-0.66258761],
       [-0.61433322],
       [-0.49820094],
       [-0.59871516],
       [-0.80767575],
       [-0.94910492],
       [-1.07340388],
       [-1.28485996],
       [-1.28473605],
       [-1.35653311],
       [-1.59390839],
       [-1.77576025],
       [-1.63493222],
       [-1.7367521 ],
       [-1.62399215],
       [-1.4838218 ],
       [-1.56272078],
       [-1.4659217 ],
       [-1.47127321],
       [-1.34868344],
       [-1.38290512],
       [-1.35872684],
       [-1.34201887],
       [-1.18744516],
       [-1.1920267 ],
       [-1.20276312],
       [-1.04341187],
       [-1.17820067],
       [-1.1681915 ],
       [-1.13086849],
       [-0.94501114],
       [-0.87508243],
       [-0.75989611],
       [-0.53635418],
       [-0.6518606 ],
       [-0.86998381],
       [-0.53321528],
       [-0.81781067],
       [-0.66997999],
       [-0.53321528],
       [-0.56339575],
       [-0.40164056],
       [-0.36472837],
       [-0.32477842],
       [-0.04447632],
       [ 0.19045267],
       [ 0.06272897],
       [-0.17981843],
       [-0.23691573],
       [-0.29724887],
       [-0.4003028 ],
       [-0.32570162],
       [-0.224842  ],
       [-0.13327766],
       [ 0.04141895],
       [-0.00492478],
       [ 0.30690324],
       [ 0.64196387],
       [ 0.64196387],
       [ 1.24397719],
       [ 1.24397719],
       [ 1.24397719],
       [ 1.17514564],
       [ 1.17514564],
       [ 1.0116176 ],
       [ 1.44369272],
       [ 1.44369272],
       [ 1.44369272],
       [ 1.51907396],
       [ 1.51907396],
       [ 1.18873498],
       [ 1.18873498],
       [ 0.84166893],
       [ 0.84166893],
       [ 0.38047617],
       [ 0.55770157],
       [ 0.55770157],
       [ 0.50964625],
       [ 0.34786926],
       [ 0.34885179],
       [ 0.24638314],
       [ 0.24018166],
       [ 0.38047617],
       [ 0.20721973],
       [ 0.38047617],
       [-0.05661083],
       [ 0.11972509],
       [-0.19681261],
       [ 0.08817619],
       [-0.21504704],
       [-0.09572807],
       [ 0.03710013],
       [ 0.03710013],
       [-0.19346524],
       [-0.19346524],
       [ 0.00468326],
       [ 0.00468326],
       [ 0.09466762],
       [ 0.09466762],
       [ 0.24962424],
       [ 0.24962424],
       [ 0.33064576],
       [ 0.23983085],
       [ 0.23983085],
       [ 0.23983085],
       [ 0.47068599],
       [ 0.47068599],
       [ 1.16707791],
       [ 1.16707791],
       [ 1.2063674 ],
       [ 1.2063674 ],
       [ 1.38084445],
       [ 1.38084445],
       [ 1.58191579],
       [ 1.58191579],
       [ 1.60227372],
       [ 1.60227372],
       [ 1.5554956 ],
       [ 1.5554956 ],
       [ 1.46327195],
       [ 1.46327195],
       [ 1.76357295],
       [ 1.76357295],
       [ 1.81855793],
       [ 1.81855793],
       [ 1.2063674 ],
       [-1.12791638],
       [-1.02480315],
       [-0.90479375],
       [-0.80635408],
       [-0.78041013],
       [-0.6474682 ],
       [-0.83806848],
       [-0.98722513],
       [-0.92913665],
       [-0.78683625],
       [-0.53667645],
       [-0.20821849],
       [ 0.36763487],
       [ 0.58771   ],
       [ 0.58771   ],
       [ 0.36763487],
       [ 0.56243804],
       [ 0.43992816],
       [ 0.52145559],
       [ 0.72501907],
       [ 0.75248222],
       [ 0.46735135],
       [ 0.45008778],
       [ 0.69072684],
       [ 0.8840586 ],
       [ 0.87319922],
       [ 1.08157431],
       [ 1.44331052],
       [ 1.44331052],
       [ 1.79583845],
       [ 1.44553487],
       [ 1.44553487],
       [ 1.44553487],
       [ 0.84122773],
       [ 0.84122773],
       [ 0.84122773],
       [ 0.96683114],
       [ 0.96683114],
       [ 1.10318762],
       [ 1.10318762],
       [ 1.20209231],
       [ 1.5557656 ],
       [ 1.5557656 ],
       [ 1.5557656 ],
       [ 0.96339436],
       [ 0.96339436],
       [ 0.96339436],
       [ 0.41519951],
       [ 0.09186522],
       [-0.06440782],
       [-0.01459025],
       [ 0.06272897],
       [-0.06240968],
       [-0.45966134],
       [-0.36909742],
       [-0.23355303],
       [ 0.03179945],
       [ 0.21477376],
       [ 0.3802928 ],
       [ 0.40467375],
       [ 0.41954203],
       [ 0.17882842],
       [ 0.40616246],
       [ 0.63174895],
       [ 0.63174895],
       [ 0.70059311],
       [ 0.70059311],
       [ 0.70059311],
       [ 0.93949342],
       [ 0.93949342],
       [ 0.93949342],
       [ 0.87409611],
       [ 0.87409611],
       [ 1.07827868],
       [ 1.28496136],
       [ 1.28496136],
       [ 1.23843771],
       [ 1.23843771],
       [ 1.11025585],
       [ 0.87956548],
       [ 1.00146972],
       [ 0.73415594],
       [ 0.73415594],
       [ 0.73415594],
       [ 1.38140816],
       [ 1.18790278],
       [ 1.03674641],
       [ 1.24025202],
       [ 1.59383052],
       [ 1.59383052],
       [ 1.69548494],
       [ 1.65906468],
       [ 1.74291896],
       [ 1.74291896],
       [ 2.05320011],
       [ 2.05320011],
       [ 2.2436213 ],
       [ 2.03506676],
       [ 2.03506676],
       [-0.79684906],
       [-0.47062703],
       [-0.31007666],
       [-0.46760818],
       [-0.46058526],
       [-0.6414578 ],
       [-0.81439414],
       [-1.01402965],
       [-1.01402965],
       [-1.35485735],
       [-1.18404602],
       [-1.49214329],
       [-1.75816113],
       [-1.71967556],
       [-1.97991755],
       [-2.04115876],
       [-2.11647041],
       [-2.03164967],
       [-2.10213193],
       [-1.78437834],
       [-1.73834127],
       [-1.71763065],
       [-1.67397398],
       [-1.67397398],
       [-1.62788114],
       [-1.48022763],
       [-1.39762213],
       [-1.46113247],
       [-1.59376141],
       [-1.61356257],
       [-1.5534961 ],
       [-1.48133277],
       [-1.38565543],
       [-1.21261253],
       [-0.99099932],
       [-0.75457668],
       [-1.16343949],
       [-1.13906939],
       [-1.14948909],
       [-1.21547075],
       [-1.27472779],
       [-1.32901744],
       [-1.52157215],
       [-1.50637785],
       [-1.38657313],
       [-1.40595352],
       [-1.32191923],
       [-1.24297608],
       [-1.36234589],
       [-1.61460286],
       [-2.02441017],
       [-1.83577016],
       [-1.57155664],
       [-1.55594187],
       [-1.63312937],
       [-1.46880132],
       [-1.43292896],
       [-1.3857865 ],
       [-1.2977936 ],
       [-1.0900922 ],
       [-1.10705211],
       [-1.31119854],
       [-1.12610213],
       [-1.13587564],
       [-1.06342253],
       [-1.04633399],
       [-0.96526651],
       [-0.89374122],
       [-0.85283741],
       [-1.00882666],
       [-0.9179288 ],
       [-1.05905297],
       [-0.98147468],
       [-0.94777339],
       [-0.86333893],
       [-0.82905692],
       [-0.72498066],
       [-0.62414672],
       [-0.70547077],
       [-0.79450441],
       [-0.91290371],
       [-1.00395624],
       [-1.10581926],
       [-1.10963267],
       [-1.05545624],
       [-0.85128703],
       [-0.91069726],
       [-0.93736112],
       [-1.02373351],
       [-0.92771906],
       [-0.84461689],
       [-0.72714218],
       [-0.67076459],
       [-0.738898  ],
       [-0.61754175],
       [-0.59104291],
       [-0.58026052],
       [-0.5118019 ],
       [-0.47769216],
       [-0.52527341],
       [-0.41320468],
       [-0.27078779],
       [-0.26810994],
       [-0.31373991],
       [-0.40059999],
       [-0.42334224],
       [-0.30186385],
       [-0.25546609],
       [-0.1488361 ],
       [-0.0843415 ],
       [-0.20854932],
       [-0.44365097],
       [-0.1843113 ],
       [-0.2404877 ],
       [-0.10477077],
       [-0.06434724],
       [-0.19208889],
       [-0.44930225],
       [-0.5300822 ],
       [-0.7199477 ],
       [-0.63307873],
       [-0.81714582],
       [-0.752106  ],
       [-0.96526651],
       [ 0.12139973],
       [ 0.07066193],
       [ 0.11403989],
       [ 0.44903532],
       [ 0.27556169],
       [ 0.4015564 ],
       [ 0.18579241],
       [-0.03255071],
       [-1.10548318],
       [-1.18041964],
       [-1.10357992],
       [-1.05338873],
       [-0.80843144],
       [-0.56913558],
       [-0.56913558],
       [-0.25750988],
       [-0.25750988],
       [-0.19458027],
       [-0.54677846],
       [-0.55425232],
       [-0.47605911],
       [-0.49136301],
       [-0.64832856],
       [-0.75485142],
       [-0.56323204],
       [-0.47078199]])</code></pre>
</div>
</div>
</section>
<section id="discussion" class="slide level2">
<h2>Discussion</h2>
<p><br><br></p>
<p>The Box-Cox transformation can:</p>
<ul>
<li><p>Make the distribution of a predictor more symmetric.</p></li>
<li><p>Help to linearize the relationship with the response.</p></li>
</ul>
<p>After transformation, the predictor <span class="math inline">\(X'\)</span> must be used instead of the original predictor <span class="math inline">\(X\)</span>.</p>
</section></section>
<section>
<section id="standarization" class="title-slide slide level1 center">
<h1>Standarization</h1>

</section>
<section id="predictors-with-different-units" class="slide level2">
<h2>Predictors with different units</h2>
<p>Many good predictive models have issues with <span style="color:blue;"><strong>numeric predictors</strong></span> with different units:</p>
<ol type="1">
<li><p>Methods such as K-nearest neighbors are based on the distance between observations. If the predictors are on different units or scales, then some predictors will have a larger weight for computing the distance.</p></li>
<li><p>Other methods such as LASSO use the variances of the predictors in their calculations. Predictors with different scales will have different variances and so, those with a higher variance will play a bigger role in the calculations.</p></li>
</ol>
</section>
<section id="section-23" class="slide level2">
<h2></h2>
<p><br><br><br><br></p>
<div style="font-size: 150%;">
<p><span style="color:purple;"><strong><em>In a nutshell, some predictors will have a higher impact in the model due to its unit and not its information provided to it.</em></strong></span></p>
</div>
</section>
<section id="standarization-1" class="slide level2">
<h2>Standarization</h2>
<p><br></p>
<p>Standardization refers to <em>centering</em> and <em>scaling</em> each numeric predictor individually. It puts every predictor on the same scale.</p>
<p>To <strong>center</strong> a predictor variable, the average predictor value is subtracted from all the values.</p>
<p>Therefore, the centered predictor has a zero mean (that is, its average value is zero).</p>
</section>
<section id="section-24" class="slide level2">
<h2></h2>
<p><br></p>
<p>To <strong>scale</strong> a predictor, each of its value is divided by its standard deviation.</p>
<p>Scaling the data coerce the values to have a common standard deviation of one.</p>
<p>In mathematical terms, we standardize a predictor as:</p>
<p><span class="math display">\[{\color{blue} \tilde{x}_{i}} = \frac{{ x_{i} - \bar{x}}}{ \sqrt{\frac{1}{n -1} \sum_{i=1}^{n} (x_{i} - \bar{x})^2}},\]</span></p>
<p>with <span class="math inline">\(\bar{x} = \sum_{i=1}^n \frac{x_i}{n}\)</span>.</p>
</section>
<section id="example-2-cont.-1" class="slide level2">
<h2>Example 2 (cont.)</h2>
<p><br></p>
<p>We concentrate on the five numerical predictors in the <code>complete_Auto</code> dataset.</p>
<div id="b3557314" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a></a><span class="co"># Select specific variables.</span></span>
<span id="cb27-2"><a></a>complete_sbAuto <span class="op">=</span> complete_Auto[[<span class="st">'cylinders'</span>, <span class="st">'displacement'</span>, </span>
<span id="cb27-3"><a></a>                                 <span class="st">'horsepower'</span>, <span class="st">'weight'</span>, </span>
<span id="cb27-4"><a></a>                                 <span class="st">'acceleration'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="two-predictors-in-original-units" class="slide level2">
<h2>Two predictors in original units</h2>
<p>Consider the <code>complete_sbAuto</code> dataset created previously. Consider two points in the plot: <span class="math inline">\((175, 5140)\)</span> and <span class="math inline">\((69, 1613)\)</span>.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div id="ea5ba814" class="cell" data-execution_count="26">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PreProcessing_files/figure-revealjs/cell-27-output-1.png" class="quarto-figure quarto-figure-center" width="458" height="435"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p><br></p>
<p>The distance between these points is <span class="math inline">\(\sqrt{(69 - 175)^2 + (1613-5140)^2}\)</span> <span class="math inline">\(= \sqrt{11236 + 12439729}\)</span> <span class="math inline">\(= 3528.592\)</span>.</p>
</div></div>
</section>
<section id="standarization-in-python" class="slide level2">
<h2>Standarization in Python</h2>
<p><br></p>
<p>To standardize <strong>numerical</strong> predictors, we use the function <code>StandardScaler()</code>. Moreover, we apply the function to the variables using the function <code>fit_transform()</code>.</p>
<p><br></p>
<div id="223e6c61" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb28-2"><a></a>Xs <span class="op">=</span> scaler.fit_transform(complete_sbAuto)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-25" class="slide level2">
<h2></h2>
<p>Unfortunately, the resulting object is not a pandas data frame. We then convert this object to this format. <br></p>
<div id="0e902eff" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a></a>scaled_df <span class="op">=</span> pd.DataFrame(Xs, columns <span class="op">=</span> complete_sbAuto.columns)</span>
<span id="cb29-2"><a></a>scaled_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cylinders</th>
<th data-quarto-table-cell-role="th">displacement</th>
<th data-quarto-table-cell-role="th">horsepower</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">acceleration</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.483947</td>
<td>1.077290</td>
<td>0.664133</td>
<td>0.620540</td>
<td>-1.285258</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.483947</td>
<td>1.488732</td>
<td>1.574594</td>
<td>0.843334</td>
<td>-1.466724</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.483947</td>
<td>1.182542</td>
<td>1.184397</td>
<td>0.540382</td>
<td>-1.648189</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.483947</td>
<td>1.048584</td>
<td>1.184397</td>
<td>0.536845</td>
<td>-1.285258</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1.483947</td>
<td>1.029447</td>
<td>0.924265</td>
<td>0.555706</td>
<td>-1.829655</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="two-predictors-in-standardized-units" class="slide level2">
<h2>Two predictors in standardized units</h2>
<p>In the new scale, the two points are now: <span class="math inline">\((1.82, 2.53)\)</span> and <span class="math inline">\((-0.91, -1.60)\)</span>.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div id="031975e0" class="cell" data-execution_count="29">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PreProcessing_files/figure-revealjs/cell-30-output-1.png" class="quarto-figure quarto-figure-center" width="444" height="435"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p><br></p>
<p>The distance between these points is <span class="math inline">\(\sqrt{(-0.91 - 1.82)^2 + (-1.60-2.53)^2}\)</span> <span class="math inline">\(= \sqrt{7.45 + 17.05} = 4.95\)</span>.</p>
</div></div>
</section>
<section id="discussion-1" class="slide level2">
<h2>Discussion</h2>
<div>
<ul>
<li class="fragment"><p>Standardized predictors are generally used to improve the numerical stability of some calculations.</p></li>
<li class="fragment"><p>It is generally recommended to always standardize numeric predictors. Perhaps the only exception would be if we consider a linear regression model.</p></li>
<li class="fragment"><p>A drawback of these transformations is the <span style="color:pink;"><strong><em>loss of interpretability</em></strong></span> since the data are no longer in the original units.</p></li>
<li class="fragment"><p>Standardizing the predictors does not affect their correlation.</p></li>
</ul>
</div>
</section></section>
<section id="return-to-main-page" class="title-slide slide level1 center">
<h1><a href="https://alanrvazquez.github.io/TEC-IN1002B-Website/">Return to main page</a></h1>

</section>

<section>
<section id="dimension-reduction" class="title-slide slide level1 center">
<h1>Dimension reduction</h1>

</section>
<section id="dimension-reduction-1" class="slide level2">
<h2>Dimension reduction</h2>
<p>Here, we will discuss methods to reduce the number of predictors in a dataset. In other words, to reduce the dimension of the dataset.</p>
<p>High-dimensional datasets can cause problems when training or fitting linear regression models. It also happens that a high-dimensional dataset can also have poorer predictive performance than a dataset with few, well selected predictors.</p>
<p>In particular, we will discuss the methods:</p>
<ol type="1">
<li>Filtering predictors based on near-zero variance and correlation.</li>
<li>Principal component analysis.</li>
</ol>
</section>
<section id="removing-predictors" class="slide level2">
<h2>Removing predictors</h2>
<p><br></p>
<p>There are potential advantages to removing predictors prior to modeling:</p>
<div>
<ul>
<li class="fragment"><p>Fewer predictors means decreased computational time and complexity.</p></li>
<li class="fragment"><p>If two predictors are highly-correlated, they are measuring the same underlying information. So, removing one should not compromise the performance of the model.</p></li>
</ul>
</div>
<div class="fragment">
<p>Here, we will see two techniques to remove predictors.</p>
</div>
</section>
<section id="near-zero-variance-predictors" class="slide level2">
<h2>Near-Zero variance predictors</h2>
<p><br></p>
<p>A <strong>near-zero variance predictor variable</strong> is one that has only a handful of unique values that occur with very low frequencies.</p>
<p><br></p>
<div class="fragment">
<p>If the predictor has a single unique value, then it is called a <strong>zero-variance predictor variable</strong>.</p>
<p><br></p>
</div>
<div class="fragment">
<p>Since the values of this predictor variable do not vary or change at all, this predictor does not provide any information to the model and must be discarded.</p>
</div>
</section>
<section id="example-3" class="slide level2">
<h2>Example 3</h2>
<p><br></p>
<p>We consider a data set related to Glass identification. The data has 214 glass samples labeled as one of seven glass categories. There are nine predictors including the refractive index (RI) and percentages of eight elements: Na, Mg, Al, Si, K, Ca, Ba, and Fe.</p>
<p>Let’s read the data set. Note that this is a modified version of the original data.</p>
<div id="eae7a73e" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a></a><span class="co"># Load Excel file (make sure the file is in your Colab)</span></span>
<span id="cb30-2"><a></a>glass_data <span class="op">=</span> pd.read_excel(<span class="st">'glass.xlsx'</span>)</span>
<span id="cb30-3"><a></a></span>
<span id="cb30-4"><a></a><span class="co"># Drop the categorical variable.</span></span>
<span id="cb30-5"><a></a>sb_glass <span class="op">=</span> glass_data.drop(columns<span class="op">=</span>[<span class="st">'Type'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="in-python-1" class="slide level2">
<h2>In Python</h2>
<p>We use the function <code>VarianceThreshold()</code> to set the threshold for determining a <em>low</em> sample variance. We also use other functions such as <code>selector.fit()</code> and <code>selector.get_support()</code>.</p>
<div id="f7ea5d4d" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a></a><span class="co"># Set threshold</span></span>
<span id="cb31-2"><a></a>selector <span class="op">=</span> VarianceThreshold(threshold<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb31-3"><a></a></span>
<span id="cb31-4"><a></a><span class="co"># Apply threshold.</span></span>
<span id="cb31-5"><a></a>selector.fit(sb_glass)</span>
<span id="cb31-6"><a></a></span>
<span id="cb31-7"><a></a><span class="co"># Identify predictors with low variance.</span></span>
<span id="cb31-8"><a></a>low_variance_cols <span class="op">=</span> sb_glass.columns[<span class="op">~</span>selector.get_support()]</span>
<span id="cb31-9"><a></a></span>
<span id="cb31-10"><a></a><span class="co"># Print the list of predictors.</span></span>
<span id="cb31-11"><a></a><span class="bu">print</span>(<span class="ss">f"Low variance columns: </span><span class="sc">{</span>low_variance_cols<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Low variance columns: Index(['RI', 'Fe'], dtype='object')</code></pre>
</div>
</div>
</section>
<section id="section-26" class="slide level2">
<h2></h2>
<p><br><br></p>
<p>After identifying predictors with low variability, we remove them from the problem because they do not add much to the problem. To this end, we use the command below.</p>
<p><br></p>
<div id="1ee3b6af" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a></a><span class="co"># Removing problematic predictors</span></span>
<span id="cb33-2"><a></a>sb_reduced_glass <span class="op">=</span> sb_glass.drop(columns<span class="op">=</span>low_variance_cols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="between-predictor-correlation" class="slide level2">
<h2>Between-predictor correlation</h2>
<p><br></p>
<p><span style="color:purple;"><strong>Collinearity</strong></span> is the technical term for the situation where two predictors have a substantial correlation with each other.</p>
<p>If two or more predictors are highly correlated (either negatively or positively), then methods such as the linear regression model will not work!</p>
<p>To visualize the severity of collinearity between predictors, we calculate and visualize the <em>correlation matrix</em>.</p>
</section>
<section id="example-2-cont.-2" class="slide level2">
<h2>Example 2 (cont.)</h2>
<p><br></p>
<p>We concentrate on the five numerical predictors in the <code>complete_Auto</code> dataset.</p>
<div id="f5b7f2fb" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a></a><span class="co"># Select specific variables.</span></span>
<span id="cb34-2"><a></a>complete_sbAuto <span class="op">=</span> complete_Auto[[<span class="st">'cylinders'</span>, <span class="st">'displacement'</span>, </span>
<span id="cb34-3"><a></a>                                 <span class="st">'horsepower'</span>, <span class="st">'weight'</span>, </span>
<span id="cb34-4"><a></a>                                 <span class="st">'acceleration'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="correlation-matrix" class="slide level2">
<h2>Correlation matrix</h2>
<p><br></p>
<p>In Python, we calculate the correlation matrix using the command below.</p>
<div id="d827bc3e" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a></a>correlation_matrix <span class="op">=</span> complete_sbAuto.corr()</span>
<span id="cb35-2"><a></a><span class="bu">print</span>(correlation_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              cylinders  displacement  horsepower    weight  acceleration
cylinders      1.000000      0.950823    0.842983  0.897527     -0.504683
displacement   0.950823      1.000000    0.897257  0.932994     -0.543800
horsepower     0.842983      0.897257    1.000000  0.864538     -0.689196
weight         0.897527      0.932994    0.864538  1.000000     -0.416839
acceleration  -0.504683     -0.543800   -0.689196 -0.416839      1.000000</code></pre>
</div>
</div>
</section>
<section id="section-27" class="slide level2">
<h2></h2>
<p>Next, we plot the correlation matrix using the function <code>heatmap()</code> from <strong>seaborn</strong>. The argument <code>annot</code> shows the actual value of the pair-wise correlations, and <code>cmap</code> shows a nice color theme.</p>
<div id="6f0d4f75" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">3</span>,<span class="dv">3</span>))</span>
<span id="cb37-2"><a></a>sns.heatmap(correlation_matrix, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, annot <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PreProcessing_files/figure-revealjs/cell-36-output-1.png" class="quarto-figure quarto-figure-center" width="369" height="345"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="section-28" class="slide level2">
<h2></h2>
<p><br></p>
<p>The predictors cylinders and displacement are highly correlated. In fact, their correlation is 0.95.</p>
<div id="b310132a" class="cell" data-execution_count="36">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PreProcessing_files/figure-revealjs/cell-37-output-1.png" class="quarto-figure quarto-figure-center" width="599" height="435"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="in-practice" class="slide level2">
<h2>In practice</h2>
<p><br></p>
<p>We deal with collinearity by removing the minimum number of predictors to ensure that all pairwise correlations are below a certain threshold, say, 0.75.</p>
<p>We can identify the variables that are highly correlated using quite complex code. However, here we will do it manually using the correlation map.</p>
<div id="9e1f653e" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a></a><span class="co"># Dataset without highly correlated predictors.</span></span>
<span id="cb38-2"><a></a>reduced_auto <span class="op">=</span> complete_sbAuto[ [<span class="st">'weight'</span>, <span class="st">'acceleration'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="IN1002b_logo.png" class="slide-logo"></p>
<div class="footer footer-default">
<p>Tecnologico de Monterrey</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/multiplex/socket.io.js"></script>
  <script src="../site_libs/revealjs/plugin/multiplex/multiplex.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-pointer/pointer.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'multiplex': {"secret":null,"id":"fb040b19bda0d6f4","url":"https://reveal-multiplex.glitch.me/"},
'pointer': {"key":"q","color":"red","pointerSize":16,"alwaysVisible":false},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealPointer, QuartoSupport,

          RevealMath,
          
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>